<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Group18-PFM</title>
<link rel="icon" href="/static/favicon.ico" type="image/ico">
<meta name="keywords" content="PFM">
<meta name="description" content="Tech Project – Personal Finance Manager">
<meta name="author" content="Group18">
<link href="/static/css/bootstrap.min.css" rel="stylesheet">
<link href="/static/css/materialdesignicons.min.css" rel="stylesheet">
<link href="/static/css/style.min.css" rel="stylesheet">
<script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
</head>
  
<body>
<div class="lyear-layout-web">
  <div class="lyear-layout-container">
    <!--左侧导航-->
    <aside class="lyear-layout-sidebar">
      
      <!-- logo -->
      <div id="logo" class="sidebar-header">
        <a href="index.html"><img src="/static/images/citi.jpg" title="PFM" alt="PFM" /></a>
      </div>
      <div class="lyear-layout-sidebar-scroll"> 
        
        <nav class="sidebar-main">
          <ul class="nav nav-drawer">
            <li class="nav-item active"> <a href="index.html"><i class="mdi mdi-home"></i> Home </a> </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="expense.html"><i class="mdi mdi-palette"></i> Expenses </a>
              <!--<ul class="nav nav-subnav">-->
                <!--<li> <a href="lyear_ui_buttons.html"> detail </a> </li>-->
              <!--</ul>-->
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-file-outline"></i> Income </a>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-language-javascript"></i> Budget </a>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-menu"></i> Accounts </a>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="/import.html"><i class="mdi mdi-format-align-justify"></i> Import Data </a>
            </li>
          </ul>
        </nav>

        <div class="sidebar-footer">
          <p class="copyright">Copyright &copy; 2020. All rights reserved. <a href="https://www.citigroup.com/citi/" target="_blank">Citi.Group18</a></p>
        </div>
      </div>
      
    </aside>
    <!--End 左侧导航-->

    <!--头部信息-->
    <header class="lyear-layout-header">

      <nav class="navbar navbar-default">
        <div class="topbar">

          <div class="topbar-left">
            <div class="lyear-aside-toggler">
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
            </div>
            <span class="navbar-page-title"> Personal Finance Manager </span>
          </div>

          <ul class="topbar-right">
            <li class="dropdown dropdown-profile">
              <a href="javascript:void(0)" data-toggle="dropdown">
                <img class="img-avatar img-avatar-48 m-r-10" src="/static/images/users/avatar.jpg" alt="Group 18" />
                <span>Group 18 <span class="caret"></span></span>
              </a>
              <ul class="dropdown-menu dropdown-menu-right">
                <li> <a href="lyear_pages_profile.html"><i class="mdi mdi-account"></i> personal info</a> </li>
                <li> <a href="lyear_pages_edit_pwd.html"><i class="mdi mdi-lock-outline"></i> update pwd</a> </li>
                <li> <a href="javascript:void(0)"><i class="mdi mdi-delete"></i> clean</a></li>
                <li class="divider"></li>
                <li> <a href="lyear_pages_login.html"><i class="mdi mdi-logout-variant"></i> logout</a> </li>
              </ul>
            </li>

          </ul>
        </div>
      </nav>
    </header>
    <!--End 头部信息-->

    <!--页面主要内容-->
    <main class="lyear-layout-content">
      
      <div class="container-fluid">
        
        <div class="row">
          <div class="col-sm-6 col-lg-3">
            <div class="card bg-primary">
              <div class="card-body clearfix">
                <div class="pull-right">
                  <p class="h6 text-white m-t-0">Expenses</p>
                  <p class="h3 text-white m-b-0">{{ bill.expenses }}</p>
                </div>
                <div class="pull-left"> <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-currency-cny fa-1-5x"></i></span> </div>
              </div>
            </div>
          </div>
          
          <div class="col-sm-6 col-lg-3">
            <div class="card bg-danger">
              <div class="card-body clearfix">
                <div class="pull-right">
                  <p class="h6 text-white m-t-0">Income</p>
                  <p class="h3 text-white m-b-0">{{ bill.income }}</p>
                </div>
                <div class="pull-left"> <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-currency-cny fa-1-5x"></i></span> </div>
              </div>
            </div>
          </div>
          
          <div class="col-sm-6 col-lg-3">
            <div class="card bg-success">
              <div class="card-body clearfix">
                <div class="pull-right">
                  <p class="h6 text-white m-t-0">Budget</p>
                  <p class="h3 text-white m-b-0">{{ bill.budget }}</p>
                </div>
                <div class="pull-left"> <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-currency-cny fa-1-5x"></i></span> </div>
              </div>
            </div>
          </div>
          
          <div class="col-sm-6 col-lg-3">
            <div class="card bg-purple">
              <div class="card-body clearfix">
                <div class="pull-right">
                  <p class="h6 text-white m-t-0">Accounts</p>
                  <p class="h3 text-white m-b-0">{{ bill.accounts }}</p>
                </div>
                <div class="pull-left"> <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi mdi-currency-cny fa-1-5x"></i></span> </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row">
          
          <div class="col-lg-6"> 
            <div class="card">
              <div class="card-header">
                <h4>Expenses Reports</h4>
              </div>
              <div class="card-body" id="circleGraph" style="height: 400px;width: 500px">
                <!--canvas class="js-chartjs-bars"></canvas>-->
              </div>
            </div>
          </div>
          
          <div class="col-lg-6"> 
            <div class="card">
              <div class="card-header">
                <h4>Expenses as {{ bill.percent }} % of Budget</h4>
              </div>
              <div class="card-body" id="circle" style="height: 400px;width: 500px">
                <!--放budget的数据-->
                <!--canvas class="js-chartjs-lines"></canvas>-->
              </div>
            </div>
          </div>

        </div>

        <div class="row">

          <div class="col-lg-6">
            <div class="card">
              <div class="card-header">
                <h4>Budget Reports</h4>
              </div>
              <div class="card-body">
                <canvas class="js-chartjs-bars" style="height: 380px;width: 500px"></canvas>
              </div>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="card">
              <div class="card-header">
                <h4>Expenses as {{ bill.percent_ei }} of Income</h4>
              </div>
              <div class="card-body" id="circle1" style="height: 400px;width: 500px">
                <!--放budget的数据-->
                <!--canvas class="js-chartjs-lines"></canvas>-->
              </div>
            </div>
          </div>


        </div>
      </div>
    </main>
    <!--End 页面主要内容-->
  </div>
</div>

<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/static/js/perfect-scrollbar.min.js"></script>
<script type="text/javascript" src="/static/js/main.min.js"></script>

<!--图表插件-->
<script type="text/javascript" src="/static/js/Chart.js"></script>
<script type="text/javascript">

    var conts = {{ contents | safe }};
    for (var cont in conts) {
       // alert(cont);
    }

    var dets = {{ details | safe }};
    for (var det in dets) {
        // det: Home/Rent-[object Object]
        //alert("det: " + det + "-" + dets[det]);

        var fields = dets[det];
        for (var field in fields) {
             // det:field: name-Home/Rent
             // alert("det:field: " + field + "-" + fields[field]);

             // det:field: sub-[object Object]
            if (field === "sub") {
                var subs = fields[field];
                for (var sub in subs) {
                    // det:field:sub: Rent-[object Object]
                    // alert("det:field:sub: " + sub + "-" + subs[sub]);

                    var sub_fields = subs[sub];
                    for (var sub_field in sub_fields) {
                        // det:field:sub:sub_field: price-1700
                        // alert("det:field:sub:sub_field: " + sub_field + "-" + sub_fields[sub_field])
                    }
                }
            }
        }

    }

// 1. Expenses Reports
  var myChart = echarts.init(document.getElementById('circleGraph'));
  //    var serviceData = {};
  // 数据数组，name 为数据项名称，value 为数据项值


  {#var serviceData = [#}
  {#  {value:2116.39, name:'Home/Rent'},#}
  {#  {value:343.99, name:'Utilities'},#}
  {#  {value:420.00, name:'Food/Groceries'},#}
  {#  {value:630.35, name:'Departmental'},#}
  {#  {value:211.12, name:'Entertainment'},#}
  {#  {value:239.75, name:'Insurance/Medical'},#}
  {#  {value:707.34, name:'Misc/one-time'}];#}

  var serviceData = [];
  var cats = {{ categories | safe }};
  for (var cat of cats) {
      // alert(cat.id + "-" + cat.name + "-" + cat.income + "-" + cat.expense + "-" + cat.budget);
      serviceData.push({value: cat.expense, name: cat.name})
  }

  myChart.setOption({
    tooltip : {
      trigger: 'item',
      formatter: "{b} <br/>{c} : {d} %"      //a 系列名称，b 数据项名称，c 数值，d 百分比
    },
    calculable : true,
    series : [
      {
        name: '访问来源',
        type: 'pie',    // 设置图表类型为饼图
        radius: '55%',  // 饼图的半径，外半径为可视区尺寸（容器高宽中较小一项）的 55% 长度。
        data:serviceData
      }
    ]
  });

// 2. Expense as % of Budget
  var myChart1 = echarts.init(document.getElementById('circle'));
  //    var serviceData = {};
  // 数据数组，name 为数据项名称，value 为数据项值

  var bills = {{ bills | safe }};
  var serviceData1 = [{value: bills.expenses, name:'Expenses'},{value: bills.remain,name:'Remain'}];

  myChart1.setOption({
    tooltip : {
      trigger: 'item',
      formatter: "{b} <br/>{c} : {d} %"      //a 系列名称，b 数据项名称，c 数值，d 百分比
    },
    calculable : true,
    series : [
      {
        name: '访问来源',
        type: 'pie',    // 设置图表类型为饼图
        radius: '55%',  // 饼图的半径，外半径为可视区尺寸（容器高宽中较小一项）的 55% 长度。
        data:serviceData1
      }
    ]
  });

// 3. Budget Reports
  // var cats = {{ categories | safe }};
  labelsData = [];
  dataData = [];
  for (var cat2 of cats) {
      // alert(cat.id + "-" + cat.name + "-" + cat.income + "-" + cat.expense + "-" + cat.budget);
      labelsData.push(cat2.name);
      dataData.push(cat2.budget)
  }

  $(document).ready(function(e) {
    var $dashChartBarsCnt = jQuery('.js-chartjs-bars')[0].getContext('2d');
    var $dashChartBarsData = {
      labels: labelsData,
      datasets: [
        {
          label: 'price',
          borderWidth: 0.5,
          borderColor: 'rgba(0,0,0,0)',
          backgroundColor: 'rgba(51,202,185,0.5)',
          hoverBackgroundColor: "rgba(51,202,185,0.7)",
          hoverBorderColor: "rgba(0,0,0,0)",
          data: dataData
        }
      ]
    };
    new Chart($dashChartBarsCnt, {
      type: 'bar',
      data: $dashChartBarsData
    });
  });

// 4. Expense as % of Income
  var myChart2 = echarts.init(document.getElementById('circle1'));
  //    var serviceData = {};
  // 数据数组，name 为数据项名称，value 为数据项值

  {#var serviceData2 = [{value:4668, name:'Expenses'},{value:1832,name:'Save'}];#}
  var serviceData2 = [{value: bills.expenses, name:'Expenses'},{value: bills.save,name:'Save'}];

  myChart2.setOption({
    tooltip : {
      trigger: 'item',
      formatter: "{b} <br/>{c} : {d} %"      //a 系列名称，b 数据项名称，c 数值，d 百分比
    },
    calculable : true,
    series : [
      {
        name: '访问来源',
        type: 'pie',    // 设置图表类型为饼图
        radius: '55%',  // 饼图的半径，外半径为可视区尺寸（容器高宽中较小一项）的 55% 长度。
        data:serviceData2
      }
    ]
  })


</script>
</body>
</html>
