<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>PFM</title>
    <link rel="icon" href="/static/favicon.ico" type="image/ico">
    <meta name="keywords" content="PFM">
    <meta name="description" content="PFM">
    <meta name="author" content="Group18">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="/static/css/style.min.css" rel="stylesheet">
    <!--时间选择插件-->
    <link rel="stylesheet" href="/static/js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css">
    <!--日期选择插件-->
    <link rel="stylesheet" href="/static/js/bootstrap-datepicker/bootstrap-datepicker3.min.css">
</head>

<body>
<div class="lyear-layout-web">
    <div class="lyear-layout-container">
        <!--左侧导航-->
        <aside class="lyear-layout-sidebar">

            <!-- logo -->
            <div id="logo" class="sidebar-header">
                <a href="index.html"><img src="/static/images/citi.jpg" title="PFM" alt="PFM" /></a>
            </div>
            <div class="lyear-layout-sidebar-scroll">

                <nav class="sidebar-main">
                    <ul class="nav nav-drawer">
                        <li class="nav-item active"> <a href="index.html"><i class="mdi mdi-home"></i> Home </a> </li>
                        <li class="nav-item nav-item-has-subnav">
                            <a href="expense.html"><i class="mdi mdi-palette"></i> Expenses </a>
                            <!--<ul class="nav nav-subnav">-->
                                <!--<li> <a href="lyear_ui_buttons.html"> detail </a> </li>-->
                            <!--</ul>-->
                        </li>
                        <li class="nav-item nav-item-has-subnav">
                            <a href="javascript:void(0)"><i class="mdi mdi-file-outline"></i> Income </a>
                        </li>
                        <li class="nav-item nav-item-has-subnav">
                            <a href="javascript:void(0)"><i class="mdi mdi-language-javascript"></i> Budget </a>
                        </li>
                        <li class="nav-item nav-item-has-subnav">
                            <a href="javascript:void(0)"><i class="mdi mdi-menu"></i> Accounts </a>
                        </li>
                        <li class="nav-item nav-item-has-subnav">
                            <a href="/import.html"><i class="mdi mdi-format-align-justify"></i> Import Data </a>
                        </li>
                    </ul>
                </nav>

                <div class="sidebar-footer">
                    <p class="copyright">Copyright &copy; 2020. All rights reserved. <a href="https://www.citigroup.com/citi/" target="_blank">Citi.Group18</a></p>
                </div>
            </div>

        </aside>
        <!--End 左侧导航-->

        <!--头部信息-->
        <header class="lyear-layout-header">

            <nav class="navbar navbar-default">
                <div class="topbar">

                    <div class="topbar-left">
                        <div class="lyear-aside-toggler">
                            <span class="lyear-toggler-bar"></span>
                            <span class="lyear-toggler-bar"></span>
                            <span class="lyear-toggler-bar"></span>
                        </div>
                        <span class="navbar-page-title"> Personal Finance Manager </span>
                    </div>

                    <ul class="topbar-right">

                        <li class="dropdown dropdown-profile">
                            <a href="javascript:void(0)" data-toggle="dropdown">
                                <img class="img-avatar img-avatar-48 m-r-10" src="/static/images/users/avatar.jpg" alt="Group 18" />
                                <span>Group 18 <span class="caret"></span></span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <li> <a href="lyear_pages_profile.html"><i class="mdi mdi-account"></i> personal info</a> </li>
                                <li> <a href="lyear_pages_edit_pwd.html"><i class="mdi mdi-lock-outline"></i> update pwd</a> </li>
                                <li> <a href="javascript:void(0)"><i class="mdi mdi-delete"></i> clean</a></li>
                                <li class="divider"></li>
                                <li> <a href="lyear_pages_login.html"><i class="mdi mdi-logout-variant"></i> logout</a> </li>
                            </ul>
                        </li>


                    </ul>
                </div>
            </nav>
        </header>
        <!--End 头部信息-->

        <!--页面主要内容-->
        <main class="lyear-layout-content">

            <div class="container-fluid">

                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header"><h4>Add Transaction</h4></div>
                        <div class="card-body">

                            <div class="form-group">
                                <label for="example-name">CategoryName</label>
                                <select class="form-control"  id="example-name" name="example-name" ></select>
                            </div>

                            <div class="form-group">
                                <label for="example-type">TransactionName</label>
                                <input class="form-control" type="name" id="example-type" name="example-type" >
                            </div>



                            <div class="form-group">
                                <label for="example-datepicker">TransactionDate</label>
                                <input class="form-control js-datepicker m-b-10" type="text" id="example-datepicker" name="example-datepicker" placeholder="" value="" data-date-format="yyyy-mm-dd" />
                            </div>
                            <div class="form-group">
                                <label for="example-price">TransactionDetail</label>
                                <input class="form-control" type="price" id="example-detail" name="example-detail" placeholder="">
                            </div>
                            <div class="form-group">
                                <label for="example-detail">TransactionPrice</label>
                                <input class="form-control" type="price" id="example-price" name="example-price" placeholder="">
                            </div>

                            <div class="form-group">
                                <button class="btn btn-primary" type="Submit" id="submit">Submit</button>
                                <button class="btn btn-primary" type="Cancel" id = "cancel">Cancel</button>
                            </div>


                        </div>
                    </div>
                </div>

            </div>

        </main>
        <!--End 页面主要内容-->

    </div>
</div>

<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/static/js/perfect-scrollbar.min.js"></script>
<!--时间选择插件-->
<script src="/static/js/bootstrap-datetimepicker/moment.min.js"></script>
<script src="/static/js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="/static/js/bootstrap-datetimepicker/locale/zh-cn.js"></script>
<!--日期选择插件-->
<script src="/static/js/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
<script src="/static/js/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>
<script type="text/javascript" src="/static/js/main.min.js"></script>
<script>

    // details 数据处理
    var catagories = [];
    var dets = {{ details | safe }};
    var nav = [];
    var navChild = [];
    for (var det in dets) {
       catagories.push(det);

        {#var fields = dets[det];#}
        {#nav.push({#}
        {#    name: fields["name"],#}
        {#    price: fields["expense"]});#}
        {##}
        {#var subs = fields["sub"];#}
        {#for(var sub in subs) {#}
        {#    var sub_fields = subs[sub];#}
        {#    navChild.push({#}
                {#id: sub_fields["id"],#}
        {#        name: sub_fields["detail"],#}
        {#        date: sub_fields["trade_date"],#}
        {#        detail: sub_fields["remark"],#}
        {#        price: sub_fields["price"]});#}
        {#}#}
    }

<!--把catagory放在select标签中-->
    {#var catagories = ["Home/Rent","Utilities","Food","Groceries", "Travel",#}
    {#    "Entertainment","Insurance/Medical","Fund money", "Salary"];#}
    for(var i =0 ; i<catagories.length;i++){
        var op=document.createElement("option");      // 新建OPTION (op)
        op.setAttribute("value",0);          		// 设置OPTION的 VALUE
        op.setAttribute("OhterAttr",catagories[i]);                   // 设置扩展属性，用于验证
        op.appendChild(document.createTextNode(catagories[i])); // 设置OPTION的 TEXT
        document.getElementById("example-name").appendChild(op);

    }
//获得用户的输入值，并放在transactionObj中
    document.getElementById("submit").onclick=function () {
            var transactionObj={};

        var myselect=document.getElementById("example-name");
        var index=myselect.selectedIndex ;
        var selectValue=myselect.options[index].text;
//        myselect.options[index].getAttribute("OhterAttr")


        transactionObj.catagoryName =selectValue;
        transactionObj.transactionName = document.getElementById("example-type").value;

        transactionObj.transactionDate = document.getElementById("example-datepicker").value;
        transactionObj.transactionDetail = document.getElementById("example-detail").value;
        transactionObj.transactionPrice = document.getElementById("example-price").value;
        console.log(transactionObj);
        //alert("submit 1");
        {#alert(transactionObj.catagoryName#}
        {#    + " " + transactionObj.transactionName#}
        {#    + " " + transactionObj.transactionDate#}
        {#    + " " + transactionObj.transactionDetail#}
        {#    + " " + transactionObj.transactionPrice#}
        {#);#}

        $.ajax({
            url: "/addTrade",
            type: "post",
            data: {type: "0",
                detail: transactionObj.transactionName,
                price: transactionObj.transactionPrice,
                trade_date: transactionObj.transactionDate,
                remark: transactionObj.transactionDetail,
                category_name: transactionObj.catagoryName
            },
            success: function (data) {
                // 成功：{"res“: 1}
                // 失败：{"res“: 0}
                if (data.res === 1) {
                    // 页面跳转
                    // $.alert('Remove Success ' );
                    // location.href = "/" + transactionObj.catagoryName + "Detail";
                    location.href = "/expense";
                    // window.history.back();
                    // location.reload();
                } else {
                    // 显示提示信息
                   // $.alert('Remove Faied! ' );
                }
                //alert("submit 2");
            }
        });

  //alert("submit 3");
    };
//设置cancel回上个页面
    document.getElementById("cancel").onclick=function () {
        window.history.back();
    };
</script>

</body>
</html>